
<!doctype html>
<html lang="hu" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Benedek Zoltán">
      
      
        <link rel="canonical" href="https://bmeviauab00.github.io/szoftvertechnikak/2024/labor/4-tobbszalu/index_ger/">
      
      
        <link rel="prev" href="../../3-felhasznaloi-felulet/index_ger/">
      
      
        <link rel="next" href="../../../hazi/meghirdetes-elott_ger/">
      
      
      <link rel="icon" href="../../../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.9">
    
    
      
        <title>4. Erstellung von Multithreading-Anwendungen - BMEVIAUAB00 Szoftvertechnikák</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.f2e4d321.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../css/timeago.css">
    
      <link rel="stylesheet" href="../../../extra-material-theme.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="aut" data-md-color-primary="aut" data-md-color-accent="red">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#4-erstellung-von-multithreading-anwendungen" class="md-skip">
          Kihagyás
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Élőfej">
    <a href="../../.." title="BMEVIAUAB00 Szoftvertechnikák" class="md-header__button md-logo" aria-label="BMEVIAUAB00 Szoftvertechnikák" data-md-component="logo">
      
  <img src="../../../img/logo-bme-aut.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            BMEVIAUAB00 Szoftvertechnikák
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              4. Erstellung von Multithreading-Anwendungen
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="aut" data-md-color-primary="aut" data-md-color-accent="red"  aria-label="Váltás sötét témára"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Váltás sötét témára" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="red" data-md-color-accent="indigo"  aria-label="Váltás világos témára"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Váltás világos témára" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Keresés" placeholder="Keresés" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Keresés">
        
        <button type="reset" class="md-search__icon md-icon" title="Törlés" aria-label="Törlés" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Keresés inicializálása
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/bmeviauab00/szoftvertechnikak" title="Főoldalra ugrás" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    bmeviauab00/szoftvertechnikak
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Lapok" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
    
  
  Szoftvertechnikák (2024-től)

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../1-model-es-kod-kapcsolata/" class="md-tabs__link">
          
  
  Laborok

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../hazi/" class="md-tabs__link">
          
  
  Önálló/házi feladatok

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../1-model-es-kod-kapcsolata/index_eng/" class="md-tabs__link">
          
  
  English course labs

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../1-model-es-kod-kapcsolata/index_ger/" class="md-tabs__link">
          
  
  Deutschkurs-Labore

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../hazi/meghirdetes-elott_ger/" class="md-tabs__link">
          
  
  Hausaufgaben

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigáció" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="BMEVIAUAB00 Szoftvertechnikák" class="md-nav__button md-logo" aria-label="BMEVIAUAB00 Szoftvertechnikák" data-md-component="logo">
      
  <img src="../../../img/logo-bme-aut.png" alt="logo">

    </a>
    BMEVIAUAB00 Szoftvertechnikák
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/bmeviauab00/szoftvertechnikak" title="Főoldalra ugrás" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    bmeviauab00/szoftvertechnikak
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Szoftvertechnikák (2024-től)
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Laborok
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Laborok
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../1-model-es-kod-kapcsolata/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. A modell és a kód kapcsolata
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2-nyelvi-eszkozok/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. Nyelvi eszközök
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../3-felhasznaloi-felulet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. A felhasználói felület kialakítása
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. Többszálú alkalmazások készítése
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../5-mvvm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5. MVVM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../6-tervezesi-mintak/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6. Tervezési minták
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../7-adatkezeles/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7. Adatkezelés
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Önálló/házi feladatok
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Önálló/házi feladatok
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../hazi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Útmutató
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../hazi/1-model-es-kod-kapcsolata/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. HF - A modell és a kód kapcsolata
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../hazi/2-nyelvi-eszkozok/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. HF - Nyelvi eszközök
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../hazi/3-felhasznaloi-felulet-kialakitasa/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. HF - Felhasználói felület kialakítása
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../hazi/meghirdetes-elott/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. HF - Többszálú alkalmazások fejlesztése
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../hazi/meghirdetes-elott/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5. HF - MVVM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../hazi/meghirdetes-elott/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6. HF - Tervezési minták
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../hazi/fejlesztokornyezet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fejlesztőkörnyezet
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    English course labs
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            English course labs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../1-model-es-kod-kapcsolata/index_eng/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. Relationship between the model and the code
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2-nyelvi-eszkozok/index_eng.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    None
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../3-felhasznaloi-felulet/index_eng.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    None
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../index_eng.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    None
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../5-mvvm/index_eng.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    None
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../6-tervezesi-mintak/index_eng.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    None
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../7-adatkezeles/index_eng.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    None
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Deutschkurs-Labore
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Deutschkurs-Labore
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../1-model-es-kod-kapcsolata/index_ger/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. Beziehung zwischen dem Modell und dem Code
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2-nyelvi-eszkozok/index_ger/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. Sprachliche Mittel
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../3-felhasznaloi-felulet/index_ger/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. Entwurf der Benutzeroberfläche
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    4. Erstellung von Multithreading-Anwendungen
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    4. Erstellung von Multithreading-Anwendungen
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Tartalomjegyzék">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tartalomjegyzék
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#das-ziel-der-ubung" class="md-nav__link">
    <span class="md-ellipsis">
      Das Ziel der Übung
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#voraussetzungen" class="md-nav__link">
    <span class="md-ellipsis">
      Voraussetzungen
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#losung" class="md-nav__link">
    <span class="md-ellipsis">
      Lösung
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#einfuhrung" class="md-nav__link">
    <span class="md-ellipsis">
      Einführung
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#0-aufgabe-kennenlernen-des-erstantrags-vorbereitung" class="md-nav__link">
    <span class="md-ellipsis">
      0. Aufgabe - Kennenlernen des Erstantrags, Vorbereitung
    </span>
  </a>
  
    <nav class="md-nav" aria-label="0. Aufgabe - Kennenlernen des Erstantrags, Vorbereitung">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#verwendung-des-codes-in-der-dll" class="md-nav__link">
    <span class="md-ellipsis">
      Verwendung des Codes in der DLL
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-task-ausfuhren-einer-operation-auf-dem-hauptthread" class="md-nav__link">
    <span class="md-ellipsis">
      1. Task - Ausführen einer Operation auf dem Hauptthread
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-aufgabe-durchfuhrung-der-berechnung-in-einem-separaten-thread" class="md-nav__link">
    <span class="md-ellipsis">
      2. Aufgabe - Durchführung der Berechnung in einem separaten Thread
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-aufgabe-verwenden-sie-dispatcherqueuehasthreadaccess-und-dispatcherqueuetryenqueue" class="md-nav__link">
    <span class="md-ellipsis">
      3. Aufgabe - verwenden Sie DispatcherQueue.HasThreadAccess und DispatcherQueue.TryEnqueue
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-problem-1-ausfuhren-einer-operation-auf-einem-threadpool-thread" class="md-nav__link">
    <span class="md-ellipsis">
      4. problem 1 - Ausführen einer Operation auf einem Threadpool-Thread
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-aufgabe-erzeuger-verbraucher-basierte-losung" class="md-nav__link">
    <span class="md-ellipsis">
      5. Aufgabe - Erzeuger-Verbraucher-basierte Lösung
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. Aufgabe - Erzeuger-Verbraucher-basierte Lösung">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#problem-1" class="md-nav__link">
    <span class="md-ellipsis">
      Problem 1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#problem-2" class="md-nav__link">
    <span class="md-ellipsis">
      Problem 2
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-problem-2-die-datafifo-klasse-sicher-machen" class="md-nav__link">
    <span class="md-ellipsis">
      6. problem 2 - Die DataFifo-Klasse sicher machen
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-aufgabe-1-umsetzung-einer-wirksamen-signalisierung" class="md-nav__link">
    <span class="md-ellipsis">
      7. aufgabe 1 - Umsetzung einer wirksamen Signalisierung
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7. aufgabe 1 - Umsetzung einer wirksamen Signalisierung">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#manualresetevent-verwenden" class="md-nav__link">
    <span class="md-ellipsis">
      ManualResetEvent verwenden
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#warten-auf-signal-blockieren-des-get" class="md-nav__link">
    <span class="md-ellipsis">
      Warten auf Signal (Blockieren des Get)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-aufgabe-1-kultivierter-stillstand" class="md-nav__link">
    <span class="md-ellipsis">
      8. aufgabe 1 - Kultivierter Stillstand
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ausblick-task-async-await" class="md-nav__link">
    <span class="md-ellipsis">
      Ausblick: Task, async, await
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../5-mvvm/index_ger.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    None
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../6-tervezesi-mintak/index_ger.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    None
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../7-adatkezeles/index_ger.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    None
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Hausaufgaben
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Hausaufgaben
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../hazi/meghirdetes-elott_ger/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. Beziehung zwischen dem Modell und dem Code
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../hazi/meghirdetes-elott_ger/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. Sprachliche Mittel
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../hazi/meghirdetes-elott_ger/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. Gestaltung der Benutzeroberfläche
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../hazi/meghirdetes-elott_ger/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. Entwicklung von Multithreading-Anwendungen
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../hazi/meghirdetes-elott_ger/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5. MVVM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../hazi/meghirdetes-elott_ger/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6. Entwurfsmuster
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../hazi/fejlesztokornyezet/index_ger/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Entwicklungsumgebung
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Tartalomjegyzék">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tartalomjegyzék
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#das-ziel-der-ubung" class="md-nav__link">
    <span class="md-ellipsis">
      Das Ziel der Übung
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#voraussetzungen" class="md-nav__link">
    <span class="md-ellipsis">
      Voraussetzungen
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#losung" class="md-nav__link">
    <span class="md-ellipsis">
      Lösung
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#einfuhrung" class="md-nav__link">
    <span class="md-ellipsis">
      Einführung
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#0-aufgabe-kennenlernen-des-erstantrags-vorbereitung" class="md-nav__link">
    <span class="md-ellipsis">
      0. Aufgabe - Kennenlernen des Erstantrags, Vorbereitung
    </span>
  </a>
  
    <nav class="md-nav" aria-label="0. Aufgabe - Kennenlernen des Erstantrags, Vorbereitung">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#verwendung-des-codes-in-der-dll" class="md-nav__link">
    <span class="md-ellipsis">
      Verwendung des Codes in der DLL
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-task-ausfuhren-einer-operation-auf-dem-hauptthread" class="md-nav__link">
    <span class="md-ellipsis">
      1. Task - Ausführen einer Operation auf dem Hauptthread
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-aufgabe-durchfuhrung-der-berechnung-in-einem-separaten-thread" class="md-nav__link">
    <span class="md-ellipsis">
      2. Aufgabe - Durchführung der Berechnung in einem separaten Thread
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-aufgabe-verwenden-sie-dispatcherqueuehasthreadaccess-und-dispatcherqueuetryenqueue" class="md-nav__link">
    <span class="md-ellipsis">
      3. Aufgabe - verwenden Sie DispatcherQueue.HasThreadAccess und DispatcherQueue.TryEnqueue
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-problem-1-ausfuhren-einer-operation-auf-einem-threadpool-thread" class="md-nav__link">
    <span class="md-ellipsis">
      4. problem 1 - Ausführen einer Operation auf einem Threadpool-Thread
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-aufgabe-erzeuger-verbraucher-basierte-losung" class="md-nav__link">
    <span class="md-ellipsis">
      5. Aufgabe - Erzeuger-Verbraucher-basierte Lösung
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. Aufgabe - Erzeuger-Verbraucher-basierte Lösung">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#problem-1" class="md-nav__link">
    <span class="md-ellipsis">
      Problem 1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#problem-2" class="md-nav__link">
    <span class="md-ellipsis">
      Problem 2
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-problem-2-die-datafifo-klasse-sicher-machen" class="md-nav__link">
    <span class="md-ellipsis">
      6. problem 2 - Die DataFifo-Klasse sicher machen
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-aufgabe-1-umsetzung-einer-wirksamen-signalisierung" class="md-nav__link">
    <span class="md-ellipsis">
      7. aufgabe 1 - Umsetzung einer wirksamen Signalisierung
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7. aufgabe 1 - Umsetzung einer wirksamen Signalisierung">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#manualresetevent-verwenden" class="md-nav__link">
    <span class="md-ellipsis">
      ManualResetEvent verwenden
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#warten-auf-signal-blockieren-des-get" class="md-nav__link">
    <span class="md-ellipsis">
      Warten auf Signal (Blockieren des Get)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-aufgabe-1-kultivierter-stillstand" class="md-nav__link">
    <span class="md-ellipsis">
      8. aufgabe 1 - Kultivierter Stillstand
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ausblick-task-async-await" class="md-nav__link">
    <span class="md-ellipsis">
      Ausblick: Task, async, await
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/bmeviauab00/szoftvertechnikak/edit/master/docs/labor/4-tobbszalu/index_ger.md" title="Oldal szerkesztése" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
    </a>
  
  


<h1 id="4-erstellung-von-multithreading-anwendungen">4. Erstellung von Multithreading-Anwendungen<a class="headerlink" href="#4-erstellung-von-multithreading-anwendungen" title="Permanent link">&para;</a></h1>
<h2 id="das-ziel-der-ubung">Das Ziel der Übung<a class="headerlink" href="#das-ziel-der-ubung" title="Permanent link">&para;</a></h2>
<p>Ziel der Übung ist es, die Studierenden mit den Grundsätzen vertraut zu machen, die bei der Programmierung mit mehreren Threads beachtet werden müssen. Behandelte Themen (unter anderem):</p>
<ul>
<li>Einen Thread starten (<code>Thread</code>)</li>
<li>Anhalten der Fasern</li>
<li>Erstellen von thread-sicheren Klassen mit dem Schlüsselwort <code>lock</code> </li>
<li><code>ThreadPool</code> verwenden</li>
<li>Signalisieren und Warten auf Signal-Thread-Synchronisation über <code>ManualResetEvent</code> (<code>WaitHandle</code>)</li>
<li>Besonderheiten des WinUI-Threadings (<code>DispatcherQueue</code>)</li>
</ul>
<p>Da das Thema sehr umfangreich ist, werden Sie natürlich nur Grundkenntnisse erwerben, aber mit diesem Wissen werden Sie in der Lage sein, komplexere Aufgaben selbständig zu bearbeiten.</p>
<p>Verwandte Präsentationen: Entwicklung konkurrierender (Multithreading-) Anwendungen.</p>
<h2 id="voraussetzungen">Voraussetzungen<a class="headerlink" href="#voraussetzungen" title="Permanent link">&para;</a></h2>
<p>Die für die Durchführung der Übung benötigten Werkzeuge:</p>
<ul>
<li>Visual Studio 2022<ul>
<li>Windows Desktop Entwicklung Workload</li>
</ul>
</li>
<li>Betriebssystem Windows 10 oder Windows 11 (Linux und macOS nicht geeignet)</li>
</ul>
<h2 id="losung">Lösung<a class="headerlink" href="#losung" title="Permanent link">&para;</a></h2>
<details class="success">
<summary>Laden Sie die fertige Lösung herunter</summary>
<p><img alt="❗" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/2757.svg" title=":exclamation:" /> Es ist wichtig, dass Sie sich während des Praktikums an die Anleitung halten. Es ist verboten (und sinnlos), die fertige Lösung herunterzuladen. Allerdings kann es bei der anschließenden Selbsteinübung nützlich sein, die fertige Lösung zu überprüfen, daher stellen wir sie zur Verfügung.</p>
<p>Die Lösung ist [verfügbar auf GitHub] (<a href="https://github.com/bmeviauab00/lab-tobbszalu-kiindulo/tree/megoldas">https://github.com/bmeviauab00/lab-tobbszalu-kiindulo/tree/megoldas</a>). Der einfachste Weg, es herunterzuladen, ist, den <code>git clone</code>-Zweig von der Kommandozeile aus zu klonen:</p>
<p><code>git clone https://github.com/bmeviauab00/lab-tobbszalu-kiindulo -b solved</code></p>
<p>Sie müssen Git auf Ihrem Rechner installiert haben, weitere Informationen <a href="../../../hazi/git-github-github-classroom/#git-telepitese">hier</a>.</p>
</details>
<h2 id="einfuhrung">Einführung<a class="headerlink" href="#einfuhrung" title="Permanent link">&para;</a></h2>
<p>Die Verwaltung parallel laufender Threads ist ein Bereich mit hoher Priorität, den alle Softwareentwickler zumindest in Grundzügen kennen sollten. In der Übung lösen wir grundlegende, aber vorrangige Probleme, so dass wir uns bemühen sollten, nicht nur das Endergebnis, sondern auch die Bedeutung und die Gründe für die von uns vorgenommenen Änderungen zu verstehen.</p>
<p>In dieser Übung werden wir einer einfachen WinUI-Anwendung Multithreading-Fähigkeiten hinzufügen und zunehmend komplexere Aufgaben lösen. Das Grundproblem ist folgendes: Wir haben eine Funktion, die lange läuft, und wie wir sehen werden, hat der "direkte" Aufruf über die Schnittstelle unangenehme Folgen. Die Lösung besteht darin, eigene Codeschnipsel zu einer bestehenden Anwendung hinzuzufügen. Neue Zeilen, die eingefügt werden sollen, sind in der Anleitung durch einen hervorgehobenen Hintergrund gekennzeichnet.</p>
<h2 id="0-aufgabe-kennenlernen-des-erstantrags-vorbereitung">0. Aufgabe - Kennenlernen des Erstantrags, Vorbereitung<a class="headerlink" href="#0-aufgabe-kennenlernen-des-erstantrags-vorbereitung" title="Permanent link">&para;</a></h2>
<p>Klonen Sie <a href="https://github.com/bmeviauab00/lab-tobbszalu-kiindulo">das Repository</a> der ursprünglichen Anwendung für Übung 4:</p>
<ul>
<li>Öffnen Sie eine Eingabeaufforderung</li>
<li>Navigieren Sie zu einem Ordner Ihrer Wahl, zum Beispiel c:workNEPTUN</li>
<li>Geben Sie den folgenden Befehl ein: <code>git clone https://github.com/bmeviauab00/lab-tobbszalu-kiindulo.git</code></li>
<li>Öffnen Sie die Lösung <em>SuperCalculator.sln</em> in Visual Studio.</li>
</ul>
<p>Unsere Aufgabe ist es, eine Benutzeroberfläche zu erstellen, um einen Algorithmus in binärer Form unter Verwendung der WinUI-Technologie auszuführen. Die binäre Form von .NET ist eine Datei mit der Erweiterung <em>.dll</em>, die in der Programmiersprache eine Klassenbibliothek darstellt.  In unserem Fall lautet der Dateiname <em>Algorithms.dll</em>, der sich im geklonten Git-Repository befindet.</p>
<p>Bei der Erstanwendung ist die Benutzeroberfläche bereits vorbereitet. Führen Sie die Anwendung aus:</p>
<p><a class="glightbox" href="../images/starter.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="starthilfe" src="../images/starter.png" /></a></p>
<p>In der Anwendungsschnittstelle können wir die Eingabeparameter des Algorithmus angeben (<code>double</code> array of numbers): in unserem Beispiel rufen wir den Algorithmus immer mit zwei Parametern auf <code>double</code> numbers, die in den beiden oberen Textfeldern angegeben werden können.
Unsere Aufgabe ist es, den Algorithmus mit den angegebenen Parametern auszuführen, indem wir auf die Schaltfläche <em>Calculate Result</em> klicken, und wenn er fertig ist, das Ergebnis mit den Eingabeparametern in einer neuen Zeile des Listenfeldes unterhalb des <em>Results</em> anzuzeigen.</p>
<p>Machen wir uns nun mit der heruntergeladenen Visual Studio-Lösung vertraut:</p>
<p>Die Rahmenanwendung ist eine auf WinUI 3 basierende Anwendung. Die Schnittstelle ist grundsätzlich fertig, ihre Definition ist in der Datei <code>MainWindow.xaml</code> zu finden. Dies ist für uns im Hinblick auf den Zweck der Übung weniger aufregend, aber es lohnt sich, sie zu Hause zu üben.</p>
<details class="note">
<summary>Gestaltung der Schnittstelle in <code>MainWindow.xaml</code></summary>
<p>Grundlagen der Gestaltung von Fensterflächen:</p>
<ul>
<li>Die Wurzel ist "normalerweise" ein <code>Grid</code>. </li>
<li>In der obersten Zeile des Wurzelgitters befindet sich das "StackPanel", das die beiden "Textboxen" und die Schaltfläche enthält.</li>
<li>Die unterste Zeile des Wurzel-"Grid" enthält ein weiteres "Grid". Im Gegensatz zur "TextBox" hat die "ListBox" keine "Header"-Eigenschaft, so dass wir diese als separaten "TextBlock" mit einem "Ergebnis"-Text einführen mussten. Dieses <code>Grid</code> wurde eingeführt (anstelle eines "einfacheren" <code>StackPanel</code>), weil es möglich war, den <code>TextBlock</code> in der oberen Zeile mit einer festen Höhe für das "Ergebnis" und die <code>ListBox</code> in der unteren Zeile so zu haben, dass sie den gesamten verbleibenden Platz ausfüllt (die Höhe der oberen Zeile ist <code>Auto</code>, die Höhe der unteren Zeile ist <code>*</code>).</li>
<li>Die Schaltfläche mit dem Text "Ergebnis berechnen" ist ein gutes Beispiel dafür, dass der <code>Inhalt</code> einer <code>Schaltfläche</code> oft nicht nur ein einfacher Text ist. Das Beispiel zeigt eine Komposition aus einem <code>SymbolIcon</code> und einem <code>TextBlock</code> (implementiert mit <code>StackPanel</code>), so dass wir ein geeignetes Icon/Symbol zuweisen können, um sein Aussehen zu verbessern.</li>
<li>Wir sehen auch ein Beispiel dafür, wie man eine <code>ListBox</code> scrollbar macht, wenn sie bereits viele Elemente enthält (oder die Elemente zu breit sind). Dazu muss der <code>ScrollViewer</code> richtig parametrisiert werden.</li>
<li>Die Eigenschaft <code>ItemContainerStyle</code> der <code>ListBox</code> wird verwendet, um Stile für das Element <code>ListBox</code> festzulegen. Im Beispiel ist "Padding" auf einen kleineren Wert als den Standardwert eingestellt, da sonst die Höhe der "ListBox"-Elemente verschwenderisch wäre.</li>
</ul>
</details>
<p>Die Quelldatei <code>MainWindow.xaml.cs</code> ist der Code hinter der Datei für das Hauptfenster, lassen Sie uns diese überprüfen, ihre Hauptelemente sind wie folgt:</p>
<ul>
<li>Um das Ergebnis und die Parameter auf <code>ListBox</code>zu protokollieren, gibt es eine Hilfsfunktion namens <code>ShowResult</code>. </li>
<li><code>CalculateResultButton_Click</code> ist der Event-Handler für das Anklicken der Schaltfläche " <em>Ergebnis berechnen</em> ". Wir sehen, dass er den Wert der Parameter aus den beiden Textfeldern liest und versucht, ihn in eine Zahl umzuwandeln. Wenn er erfolgreich ist, wird der Algorithmus hier aufgerufen (dies ist noch nicht implementiert), oder wenn er fehlschlägt, wird der Benutzer über <code>DisplayInvalidElementDialog</code> in einem Nachrichtenfenster über ungültige Parameter informiert.</li>
<li>Die Funktion <code>AddKeyboardAcceleratorToChangeTheme</code>, die vom Konstruktor aufgerufen wird, ist für uns nicht relevant, sie ermöglicht das Umschalten zwischen hellen und dunklen Themen (Sie sollten es zur Laufzeit ausprobieren, <span class="keys"><kbd class="key-control">Ctrl</kbd><span>+</span><kbd class="key-t">T</kbd></span> ).</li>
</ul>
<h3 id="verwendung-des-codes-in-der-dll">Verwendung des Codes in der DLL<a class="headerlink" href="#verwendung-des-codes-in-der-dll" title="Permanent link">&para;</a></h3>
<p>Im ursprünglichen Projekt finden wir die <em>Datei Algorithm.dll.</em> In dieser kompilierten Form gibt es eine Klasse <code>SuperAlgorithm</code> im Namensraum <code>Algorithms</code>, die eine statische Operation namens <code>Calculate</code> hat. Um die Klassen einer DLL in einem Projekt verwenden zu können, müssen Sie in Ihrem Projekt einen Verweis auf die DLL hinzufügen.</p>
<ol>
<li>
<p>Klicken Sie im Projektmappen-Explorer mit der rechten Maustaste auf den Knoten <em>Abhängigkeiten</em> Ihres Projekts und wählen Sie <em>Projektreferenz hinzufügen</em> </p>
<p><a class="glightbox" href="../images/add-project-ref.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Projektreferenz hinzufügen" src="../images/add-project-ref.png" /></a></p>
<div class="admonition note">
<p class="admonition-title">Externe Referenzen</p>
<p>Hier verweisen wir eigentlich nicht auf ein anderes Visual Studio-Projekt, aber dies ist der einfachste Weg, dieses Fenster aufzurufen.</p>
<p>Es sollte auch erwähnt werden, dass wir für externe Klassenbibliotheken keine DLLs mehr in einem regulären Projekt referenzieren, sondern die externen Pakete aus dem NuGet-Repository des .NET-Paketmanagers beziehen. Nun ist <em>Algorithm.dll</em> in unserem Fall nicht in NuGet veröffentlicht, so dass wir sie manuell hinzufügen müssen.</p>
</div>
</li>
<li>
<p>Verwenden Sie die Schaltfläche <em>Durchsuchen</em> in der rechten unteren Ecke des Popup-Fensters, wählen Sie die Datei <em>Algorithms.dll</em> im Unterordner <em>External</em> Ihres Projekts aus und klicken Sie auf OK, um das Hinzufügen zu bestätigen</p>
</li>
</ol>
<p>Im Projektmappen-Explorer können Sie auf den Knoten <em>Abhängigkeiten</em> unter einem Projekt klicken, um die referenzierten externen Abhängigkeiten anzuzeigen. Der Verweis auf Algorithmen, der zuvor in Baugruppen enthalten war, wird nun auch hier angezeigt. Die Kategorie Frameworks enthält die .NET Framework-Pakete. Und Analyzer sind Werkzeuge für die statische Codeanalyse zur Kompilierzeit. Oder es gäbe auch die Projekt- oder NuGet-Referenzen.</p>
<p><a class="glightbox" href="../images/dependencies.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Abhängigkeiten" src="../images/dependencies.png" /></a></p>
<p>Klicken Sie mit der rechten Maustaste auf die Referenz Algorithms und wählen Sie <em>View in Object Browser</em>. Dies öffnet die Registerkarte Objektbrowser, in der Sie sehen können, welche Namespaces, Klassen und deren Mitglieder (Membervariable, Memberfunktion, Eigenschaft, Ereignis) in der angegebenen DLL enthalten sind. Visual Studio liest diese aus den DLL-Metadaten mit Hilfe des so genannten Reflection-Mechanismus (wir können diesen Code selbst schreiben).</p>
<p>Wie in der Abbildung unten dargestellt, suchen Sie im Objektbrowser den Knoten Algorithmen auf der linken Seite, öffnen ihn und sehen, dass er einen Namensraum <code>Algorithms</code> und eine Klasse <code>SuperAlgorithm</code> enthält. Wenn Sie dies auswählen, werden die Funktionen der Klasse in der Mitte angezeigt, und wenn Sie hier eine Funktion auswählen, wird die genaue Signatur dieser Funktion angezeigt:</p>
<p><a class="glightbox" href="../images/object-browser.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Objekt-Browser" src="../images/object-browser.png" /></a></p>
<h2 id="1-task-ausfuhren-einer-operation-auf-dem-hauptthread">1. Task - Ausführen einer Operation auf dem Hauptthread<a class="headerlink" href="#1-task-ausfuhren-einer-operation-auf-dem-hauptthread" title="Permanent link">&para;</a></h2>
<p>Jetzt können wir mit der Ausführung des Algorithmus fortfahren. Zunächst tun wir dies im Hauptthread unserer Anwendung.</p>
<ol>
<li>
<p>Im Event-Handler der Schaltfläche <code>Click</code> im Hauptfenster rufen wir unsere Zählerfunktion auf. Öffnen Sie dazu die Datei <code>MainWindow.xaml.cs</code> code behind im Projektmappen-Explorer und suchen Sie nach <code>CalculateResultButton_Click</code> event handler. Vervollständigen Sie den Code durch den Aufruf des neu aufgerufenen Algorithmus.</p>
<div class="highlight"><pre><span></span><code><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">CalculateResultButton_Click</span><span class="p">(</span><span class="kt">object</span><span class="w"> </span><span class="n">sender</span><span class="p">,</span><span class="w"> </span><span class="n">RoutedEventArgs</span><span class="w"> </span><span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">.</span><span class="n">TryParse</span><span class="p">(</span><span class="n">param1TextBox</span><span class="p">.</span><span class="n">Text</span><span class="p">,</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">var</span><span class="w"> </span><span class="n">p1</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="kt">double</span><span class="p">.</span><span class="n">TryParse</span><span class="p">(</span><span class="n">param2TextBox</span><span class="p">.</span><span class="n">Text</span><span class="p">,</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">var</span><span class="w"> </span><span class="n">p2</span><span class="p">))</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">parameters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">double</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">p1</span><span class="p">,</span><span class="w"> </span><span class="n">p2</span><span class="w"> </span><span class="p">};</span>

<span class="hll"><span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Algorithms</span><span class="p">.</span><span class="n">SuperAlgorithm</span><span class="p">.</span><span class="n">Calculate</span><span class="p">(</span><span class="n">parameters</span><span class="p">);</span>
</span><span class="hll"><span class="w">        </span><span class="n">ShowResult</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">);</span>
</span><span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="nf">DisplayInvalidElementDialog</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>Probieren wir die Anwendung aus und stellen fest, dass das Fenster während der Berechnung nicht auf Verschieben oder Größenänderung reagiert, die Schnittstelle friert praktisch ein.</p>
</li>
</ol>
<p>Unsere Anwendung ist ereignisgesteuert, wie alle Windows-Anwendungen. Das Betriebssystem benachrichtigt unsere Anwendung über die verschiedenen Interaktionen (z. B. Verschieben, Größenänderung, Mausklick): Da der einzige Thread unserer Anwendung nach dem Tastendruck mit der Berechnung beschäftigt ist, kann er nicht sofort weitere Benutzeranweisungen verarbeiten. Sobald die Berechnung abgeschlossen ist (und die Ergebnisse in der Liste angezeigt werden), werden die zuvor erhaltenen Befehle ausgeführt.</p>
<h2 id="2-aufgabe-durchfuhrung-der-berechnung-in-einem-separaten-thread">2. Aufgabe - Durchführung der Berechnung in einem separaten Thread<a class="headerlink" href="#2-aufgabe-durchfuhrung-der-berechnung-in-einem-separaten-thread" title="Permanent link">&para;</a></h2>
<p>Im nächsten Schritt werden wir einen separaten Thread starten, um die Berechnung durchzuführen, damit die Benutzeroberfläche nicht blockiert wird.</p>
<ol>
<li>
<p>Erstellen Sie eine neue Funktion in der Klasse <code>MainWindow</code>, die der Einstiegspunkt für den Verarbeitungs-Thread sein wird.</p>
<div class="highlight"><pre><span></span><code><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">CalculatorThread</span><span class="p">(</span><span class="kt">object</span><span class="w"> </span><span class="n">arg</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">parameters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">[])</span><span class="n">arg</span><span class="p">;</span>
<span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Algorithms</span><span class="p">.</span><span class="n">SuperAlgorithm</span><span class="p">.</span><span class="n">Calculate</span><span class="p">(</span><span class="n">parameters</span><span class="p">);</span>
<span class="w">    </span><span class="n">ShowResult</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>Starten Sie den Thread in der Ereignisverwaltung der Schaltfläche <code>Click</code>.  Ersetzen Sie dazu den Code, den Sie zuvor hinzugefügt haben:</p>
<div class="highlight"><pre><span></span><code><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">CalculateResultButton_Click</span><span class="p">(</span><span class="kt">object</span><span class="w"> </span><span class="n">sender</span><span class="p">,</span><span class="w"> </span><span class="n">RoutedEventArgs</span><span class="w"> </span><span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">.</span><span class="n">TryParse</span><span class="p">(</span><span class="n">param1TextBox</span><span class="p">.</span><span class="n">Text</span><span class="p">,</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">var</span><span class="w"> </span><span class="n">p1</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="kt">double</span><span class="p">.</span><span class="n">TryParse</span><span class="p">(</span><span class="n">param2TextBox</span><span class="p">.</span><span class="n">Text</span><span class="p">,</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">var</span><span class="w"> </span><span class="n">p2</span><span class="p">))</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">parameters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">double</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">p1</span><span class="p">,</span><span class="w"> </span><span class="n">p2</span><span class="w"> </span><span class="p">};</span>

<span class="hll"><span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">th</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">(</span><span class="n">CalculatorThread</span><span class="p">);</span>
</span><span class="hll"><span class="w">        </span><span class="n">th</span><span class="p">.</span><span class="n">Start</span><span class="p">(</span><span class="n">parameters</span><span class="p">);</span>
</span><span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="nf">DisplayInvalidElementDialog</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<p>Der in der Operation <code>Start</code> des Thread-Objekts übergebene Parameter wird an unsere Thread-Funktion <code>CalculatorThread</code> übergeben.</p>
</li>
<li>
<p>Führen Sie die Anwendung ++mit f5++aus (jetzt ist es wichtig, sie so auszuführen, im Debugger)! <em>Die Anwendung rief eine Schnittstelle auf, die für einen anderen Thread bereitgestellt wurde. (0x8001010E (RPC_E_WRONG_THREAD))</em> Fehlermeldung in der Methode <code>ShowResult</code>, weil wir nicht versuchen, auf das UI-Element/Controller von dem Thread aus zuzugreifen, der es erstellt hat (der Controller). In der nächsten Übung werden wir dieses Problem analysieren und lösen.</p>
</li>
</ol>
<h2 id="3-aufgabe-verwenden-sie-dispatcherqueuehasthreadaccess-und-dispatcherqueuetryenqueue">3. Aufgabe - verwenden Sie <code>DispatcherQueue.HasThreadAccess</code> und <code>DispatcherQueue.TryEnqueue</code><a class="headerlink" href="#3-aufgabe-verwenden-sie-dispatcherqueuehasthreadaccess-und-dispatcherqueuetryenqueue" title="Permanent link">&para;</a></h2>
<p>Das Problem im vorigen Punkt hat folgende Ursachen. Für WinUI-Anwendungen gilt folgende Regel: Fenster/Oberflächen/Steuerelemente sind standardmäßig keine thread-sicheren Objekte, so dass <strong>auf ein Fenster/Oberfläche/Steuerelement nur von einem Thread aus zugegriffen werden sollte (**z. B.
i **n</strong> unserer Anwendung gibt es eine Ausnahme, da das <code>resultListBox</code> Steuerelement im Haupt-Thread erstellt wird, aber in der <code>ShowResult</code> Methode, wenn das Ergebnis angezeigt wird, wird von einem anderen Thread aus darauf zugegriffen (Aufruf der<code>resultListBox.Items.Add</code> Aktion).</p>
<p>Die Frage ist, wie auf diese Schnittstellen/Controller von einem anderen Thread aus noch irgendwie zugegriffen werden kann. Die Lösung besteht in der Verwendung von <code>DispatcherQueue</code>, um sicherzustellen, dass der Zugriff auf die Steuerelemente immer über den richtigen Thread erfolgt:</p>
<ul>
<li><code>DispatcherQueue</code> des <code>TryEnqueue</code> -Objekts führt die als Parameter angegebene Funktion auf dem Thread aus, der das Steuerelement erstellt (von dem aus Sie nun direkt auf das Steuerelement zugreifen können).</li>
<li>Die Eigenschaft <code>HasThreadAccess</code> des Objekts <code>DispatcherQueue</code> hilft bei der Entscheidung, ob es notwendig ist, <code>TryEnqueue</code> zu verwenden, wie im vorherigen Abschnitt erwähnt. Wenn die Immobilie<ul>
<li>wahr ist, kann auf den Controller direkt zugegriffen werden (weil der aktuelle Thread derselbe ist wie der Thread, der den Controller erstellt hat), aber wenn</li>
<li>falsch ist, kann auf den Controller nur unter Umgehung des <code>DispatcherQueue</code> Objekts <code>TryEnqueue</code> zugegriffen werden (da der aktuelle Thread NICHT mit dem Thread identisch ist, der den Controller erstellt hat).</li>
</ul>
</li>
</ul>
<p>Mit <code>DispatcherQueue</code> können wir also unsere vorherige Ausnahme vermeiden (der Zugriff auf den Controller, in diesem Fall <code>resultListBox</code>, kann an den entsprechenden Thread "geleitet" werden). Wir werden dies im Folgenden tun.</p>
<div class="admonition hinweis">
<p class="admonition-title">Hinweis</p>
<p>Das Objekt <code>DispatcherQueue</code> ist in Nachkommen der Klasse Window über die Eigenschaft<code>DispatcherQueue</code> verfügbar (und in anderen Klassen über die statische Operation <code>DispatcherQueue.GetForCurrentThread()</code> ).</p>
</div>
<p>Wir müssen die Methode <code>ShowResult</code> so ändern, dass sie keine Ausnahme auslöst, wenn sie von einer Erweiterung aus aufgerufen wird.</p>
<div class="highlight"><pre><span></span><code><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ShowResult</span><span class="p">(</span><span class="kt">double</span><span class="p">[]</span><span class="w"> </span><span class="n">parameters</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">result</span><span class="p">)</span>
<span class="p">{</span>
<span class="hll"><span class="w">    </span><span class="c1">// Closing the window the DispatcherQueue property may return null, so we have to perform a null check</span>
</span><span class="hll"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">DispatcherQueue</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="p">)</span>
</span><span class="hll"><span class="w">        </span><span class="k">return</span><span class="p">;</span>
</span>
<span class="hll"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">DispatcherQueue</span><span class="p">.</span><span class="n">HasThreadAccess</span><span class="p">)</span>
</span><span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ListBoxItem</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">Content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">$&quot;{parameters[0]} #  {parameters[1]} = {result}&quot;</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">        </span><span class="n">resultListBox</span><span class="p">.</span><span class="n">Items</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
<span class="w">        </span><span class="n">resultListBox</span><span class="p">.</span><span class="n">ScrollIntoView</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">    </span><span class="p">{</span>
<span class="hll"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="n">DispatcherQueue</span><span class="p">.</span><span class="n">TryEnqueue</span><span class="p">(</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">ShowResult</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
</span><span class="hll"><span class="w">    </span><span class="p">}</span>
</span><span class="p">}</span>
</code></pre></div>
<p>Probieren wir es aus!</p>
<p>Diese Lösung ist bereits einsatzbereit und besteht im Wesentlichen aus folgenden Elementen:</p>
<ul>
<li>Die Rolle des <code>DispatcherQueue</code> <code>null</code> -Scans: Nach dem Schließen des Hauptfensters ist <code>DispatcherQueue</code> nicht mehr <code>null</code>, es kann nicht verwendet werden.</li>
<li>Die <code>DispatcherQueue.HasThreadAccess</code> wird verwendet, um zu prüfen, ob der aufrufende Thread direkt auf die Controller zugreifen kann (in unserem Fall <code>ListBox</code>):<ul>
<li>Wenn ja, wird alles wie bisher gehandhabt, der Code für <code>ListBox</code>bleibt unverändert.</li>
<li>Falls nicht, können Sie über <code>DispatcherQueue.TryEnqueue</code> auf den Controller zugreifen. Dabei wird der folgende Trick angewendet. Die Funktion <code>TryEnqueue</code> erhält eine parameterlose, einzeilige Funktion in Form eines Lambda-Ausdrucks, der unsere Funktion <code>ShowResult</code> aufruft (effektiv rekursiv) und ihr die Parameter übergibt. Das ist gut für uns, weil dieser <code>ShowResult</code> -Aufruf bereits auf dem Thread erfolgt, der den Controller erstellt hat (dem Hauptthread der Anwendung), der Wert von <code>HasThreadAccess</code> ist jetzt wahr, und wir können direkt auf unser <code>ListBox</code>zugreifen. Dieser rekursive Ansatz ist ein gängiges Muster, um redundanten Code zu vermeiden.</li>
</ul>
</li>
</ul>
<p>Setzen Sie einen Haltepunkt in der ersten Zeile der Operation <code>ShowResult</code>, und führen Sie die Anwendung aus, um sicherzustellen, dass <code>HasThreadAccess</code> falsch ist, wenn <code>ShowResult</code> zum ersten Mal aufgerufen wird (also wird <code>TryEnqueue</code> aufgerufen), und dann wird <code>ShowResult</code> erneut aufgerufen, aber <code>HasThreadAccess</code> ist wahr.</p>
<p>Nehmen Sie den Haltepunkt heraus und führen Sie die Anwendung aus: Beachten Sie, dass Sie, während eine Berechnung läuft, eine andere starten können, da Ihre Schnittstelle durchgehend ansprechbar bleibt (und der Fehler, der zuvor auftrat, nicht mehr auftritt).</p>
<h2 id="4-problem-1-ausfuhren-einer-operation-auf-einem-threadpool-thread">4. problem 1 - Ausführen einer Operation auf einem Threadpool-Thread<a class="headerlink" href="#4-problem-1-ausfuhren-einer-operation-auf-einem-threadpool-thread" title="Permanent link">&para;</a></h2>
<p>Eine Besonderheit der bisherigen Lösung ist, dass sie immer einen neuen Thread für die Operation erstellt. In unserem Fall ist dies nicht besonders wichtig, aber dieser Ansatz kann für eine Serveranwendung, die eine große Anzahl von Anfragen bedient, problematisch sein, da für jede Anfrage ein eigener Thread gestartet wird. Aus zwei Gründen:</p>
<ul>
<li>Wenn die Thread-Funktion schnell läuft (um einen Client schnell zu bedienen), dann wird ein großer Teil der CPU für das Starten und Stoppen von Threads verschwendet, was an sich schon ressourcenintensiv ist.</li>
<li>Es können zu viele Threads erstellt werden, und das Betriebssystem muss zu viele planen, was unnötig Ressourcen verschwendet.</li>
</ul>
<p>Ein weiteres Problem mit unserer derzeitigen Lösung: Da die Berechnung <strong>auf einem</strong> so genannten <strong>Vordergrund-Thread</strong> läuft (neu erstellte Threads sind standardmäßig Vordergrund-Threads), läuft das Programm selbst dann im Hintergrund weiter, wenn Sie die Anwendung schließen, bis die letzte Berechnung ausgeführt wurde: Ein Prozess hört erst auf zu laufen, wenn er keinen Vordergrund-Thread mehr hat.</p>
<p>Ändern Sie den Event-Handler der Schaltfläche, um die Berechnung in einem <strong>Threadpool-Thread</strong> auszuführen, anstatt einen neuen Thread zu starten. Um dies zu tun, schreiben Sie einfach den Event-Handler für das Drücken der Schaltfläche um.</p>
<div class="highlight"><pre><span></span><code><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">CalculateResultButton_Click</span><span class="p">(</span><span class="kt">object</span><span class="w"> </span><span class="n">sender</span><span class="p">,</span><span class="w"> </span><span class="n">RoutedEventArgs</span><span class="w"> </span><span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">.</span><span class="n">TryParse</span><span class="p">(</span><span class="n">param1TextBox</span><span class="p">.</span><span class="n">Text</span><span class="p">,</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">var</span><span class="w"> </span><span class="n">p1</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="kt">double</span><span class="p">.</span><span class="n">TryParse</span><span class="p">(</span><span class="n">param2TextBox</span><span class="p">.</span><span class="n">Text</span><span class="p">,</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">var</span><span class="w"> </span><span class="n">p2</span><span class="p">))</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">parameters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">double</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">p1</span><span class="p">,</span><span class="w"> </span><span class="n">p2</span><span class="w"> </span><span class="p">};</span>

<span class="hll"><span class="w">        </span><span class="n">ThreadPool</span><span class="p">.</span><span class="n">QueueUserWorkItem</span><span class="p">(</span><span class="n">CalculatorThread</span><span class="p">,</span><span class="w"> </span><span class="n">parameters</span><span class="p">);</span>
</span><span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="nf">DisplayInvalidElementDialog</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<p>Probieren wir die Anwendung aus und stellen fest, dass die Anwendung sofort anhält, wenn das Fenster geschlossen wird, ohne sich um eventuell noch laufende Threads zu kümmern (denn Threadpool-Threads sind Hintergrund-Threads).</p>
<h2 id="5-aufgabe-erzeuger-verbraucher-basierte-losung">5. Aufgabe - Erzeuger-Verbraucher-basierte Lösung<a class="headerlink" href="#5-aufgabe-erzeuger-verbraucher-basierte-losung" title="Permanent link">&para;</a></h2>
<p>Allein durch die Lösung der vorangegangenen Probleme erhielten wir eine vollständige und gut funktionierende Lösung für das ursprüngliche Problem, die es ermöglicht, dass mehrere Threads parallel im Hintergrund arbeiten, wenn die Taste viele Male hintereinander gedrückt wird. Im Folgenden werden wir unsere Anwendung so modifizieren, dass ein Tastendruck nicht immer einen neuen Thread erzeugt, sondern die Aufgaben in eine Aufgabenwarteschlange stellt, aus der mehrere im Hintergrund laufende Threads sie nacheinander auswählen und ausführen. Bei dieser Aufgabe handelt es sich um das klassische Erzeuger-Verbraucher-Problem, das in der Praxis häufig auftritt und in der folgenden Abbildung dargestellt ist.</p>
<p><a class="glightbox" href="../images/termelo-fogyaszto.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Produzierender Verbraucher" src="../images/termelo-fogyaszto.png" /></a></p>
<div class="admonition tip">
<p class="admonition-title">Producer-Consumer vs <code>ThreadPool</code></p>
<p>Wenn Sie darüber nachdenken, ist <code>ThreadPool</code> auch ein spezieller Producer-Consumer- und Scheduler-Mechanismus, der uns von .NET zur Verfügung gestellt wird. Im Folgenden entwickeln wir eine andere Art von Erzeuger-Verbraucher-Lösung für einige der mit der Faserbewirtschaftung verbundenen Wettbewerbsprobleme.</p>
</div>
<p>Der Hauptthread ist der Producer, der eine neue Aufgabe erstellt, indem er auf die Schaltfläche <em>Ergebnis berechnen</em> klickt. Wir werden mehr Threads in der konsumierenden/verarbeitenden Arbeitslast starten, da wir mehr CPU-Kerne verwenden und die Ausführung von Aufgaben parallelisieren können.</p>
<p>Für die Zwischenspeicherung von Aufgaben können wir die Klasse <code>DataFifo</code> (im Ordner <code>Data</code> im Projektmappen-Explorer) verwenden, die in unserem ursprünglichen Projekt bereits etwas vorbereitet ist. Schauen wir uns den Quellcode an. Es implementiert eine einfache FIFO-Warteschlange, um <code>double[]</code> zu speichern. Die Methode <code>Put</code> hängt die neuen Paare an das Ende der internen Liste an, während die Methode <code>TryGet</code> das erste Element der internen Liste zurückgibt (und entfernt). Wenn die Liste leer ist, kann die Funktion kein Element zurückgeben. In diesem Fall zeigt <code>false</code> dies durch einen Rückgabewert an.</p>
<ol>
<li>
<p>Ändern Sie den Event-Handler der Schaltfläche so, dass er nicht in <code>ThreadPool</code>, sondern in FIFO arbeitet:</p>
<div class="highlight"><pre><span></span><code><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">CalculateResultButton_Click</span><span class="p">(</span><span class="kt">object</span><span class="w"> </span><span class="n">sender</span><span class="p">,</span><span class="w"> </span><span class="n">RoutedEventArgs</span><span class="w"> </span><span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">.</span><span class="n">TryParse</span><span class="p">(</span><span class="n">param1TextBox</span><span class="p">.</span><span class="n">Text</span><span class="p">,</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">var</span><span class="w"> </span><span class="n">p1</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="kt">double</span><span class="p">.</span><span class="n">TryParse</span><span class="p">(</span><span class="n">param2TextBox</span><span class="p">.</span><span class="n">Text</span><span class="p">,</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">var</span><span class="w"> </span><span class="n">p2</span><span class="p">))</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">parameters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">double</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">p1</span><span class="p">,</span><span class="w"> </span><span class="n">p2</span><span class="w"> </span><span class="p">};</span>

<span class="hll"><span class="w">        </span><span class="n">_fifo</span><span class="p">.</span><span class="n">Put</span><span class="p">(</span><span class="n">parameters</span><span class="p">);</span>
</span><span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="nf">DisplayInvalidElementDialog</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>Erstellen Sie eine naive Implementierung der neuen Thread-Handler-Funktion in Ihrer Formularklasse:</p>
<div class="highlight"><pre><span></span><code><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">WorkerThread</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="k">true</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">_fifo</span><span class="p">.</span><span class="n">TryGet</span><span class="p">(</span><span class="k">out</span><span class="w"> </span><span class="kt">var</span><span class="w"> </span><span class="n">data</span><span class="p">))</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="kt">double</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Algorithms</span><span class="p">.</span><span class="n">SuperAlgorithm</span><span class="p">.</span><span class="n">Calculate</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
<span class="w">            </span><span class="n">ShowResult</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">Thread</span><span class="p">.</span><span class="n">Sleep</span><span class="p">(</span><span class="m">500</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Der Grund für die Einführung von <code>Thread.Sleep</code> ist, dass sich die Threads sonst unnötigerweise die ganze Zeit mit einem leeren FIFO drehen würden, ohne irgendeinen nützlichen Vorgang auszuführen, und einen CPU-Kern zu 100% überlasten würden. Unsere Lösung ist nicht ideal, wir werden sie später verbessern.</p>
</li>
<li>
<p>Erstellen und starten Sie die Verarbeitungs-Threads im Konstruktor:</p>
<div class="highlight"><pre><span></span><code><span class="k">new</span><span class="w"> </span><span class="nf">Thread</span><span class="p">(</span><span class="n">WorkerThread</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Worker thread 1&quot;</span><span class="w"> </span><span class="p">}.</span><span class="n">Start</span><span class="p">();</span>
<span class="k">new</span><span class="w"> </span><span class="nf">Thread</span><span class="p">(</span><span class="n">WorkerThread</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Worker thread 2&quot;</span><span class="w"> </span><span class="p">}.</span><span class="n">Start</span><span class="p">();</span>
<span class="k">new</span><span class="w"> </span><span class="nf">Thread</span><span class="p">(</span><span class="n">WorkerThread</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Worker thread 3&quot;</span><span class="w"> </span><span class="p">}.</span><span class="n">Start</span><span class="p">();</span>
</code></pre></div>
</li>
<li>
<p>Starten Sie die Anwendung und schließen Sie sie sofort, ohne auf die Schaltfläche <em>Ergebnis berechnen</em> zu klicken. Unser Fenster wird geschlossen, aber unser Prozess läuft weiter, und die einzige Möglichkeit, die Anwendung zu schließen, ist über Visual Studio oder den Task-Manager:</p>
<p><a class="glightbox" href="../images/stop-debugging.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Fehlersuche beenden" src="../images/stop-debugging.png" /></a></p>
<p>Bei den Verarbeitungsfasern handelt es sich um Vorfilamente, die verhindern, dass der Prozess am Ausgang abbricht. Eine Lösung könnte darin bestehen, die Eigenschaft <code>IsBackground</code> der Threads auf <code>true</code>zu setzen, nachdem sie erstellt wurden. Die andere Lösung besteht darin, sicherzustellen, dass die Verarbeitungs-Threads beim Beenden beendet werden. Lassen wir dieses Thema erst einmal beiseite, wir kommen später darauf zurück.</p>
</li>
<li>
<p>Starten Sie die Anwendung und Sie werden feststellen, dass Sie nach dem Klicken auf die Schaltfläche <em>Ergebnis berechnen</em> (nur einmal klicken) höchstwahrscheinlich eine Ausnahme erhalten. Das Problem ist, dass <code>DataFifo</code> nicht thread-sicher ist, es ist inkonsistent geworden. Hierfür gibt es zwei Ursachen:</p>
</li>
</ol>
<h3 id="problem-1">Problem 1<a class="headerlink" href="#problem-1" title="Permanent link">&para;</a></h3>
<p>Betrachten wir das folgende Szenario:</p>
<ol>
<li>Die Zeile ist leer. Die verarbeitenden Threads fragen den FIFO kontinuierlich in einer <code>while</code> -Schleife ab, d. h. sie rufen die Methode <code>TryGet</code> auf.</li>
<li>Der Benutzer fügt der Warteschlange eine Aufgabe hinzu.</li>
<li>Einer der Verarbeitungsstränge in der Methode <code>TryGet</code> stellt fest, dass Daten in der Zeile vorhanden sind, d. h. die Bedingung <code>if ( _innerList.Count &gt; 0 )</code> code line ist erfüllt, und geht zur nächsten Codezeile über. Angenommen, dieser Thread verliert an dieser Stelle seine Laufzeit, dann hat er keine Zeit mehr, die Daten aus der Warteschlange zu nehmen.</li>
<li>Ein anderer Verarbeitungsthread lässt die Prüfung von <code>if ( _innerList.Count &gt; 0 )</code> zu diesem Zeitpunkt ebenfalls fallen, die Bedingung ist ebenfalls erfüllt, und dieser Thread nimmt die Daten aus der Warteschlange.</li>
<li>Der erste Thread wird neu geplant, wacht auf und versucht, die Daten aus der Warteschlange zu nehmen: die Warteschlange ist leer, der andere Thread hat die einzigen Daten aus der Warteschlange vor ihm genommen. Der Zugriff auf <code>_innerList[0]</code> führt daher zu einer Ausnahme.</li>
</ol>
<p>Die einzige Möglichkeit, dieses Problem zu vermeiden, besteht darin, die Prüfung der Zeilenleere und die Elementausnahme unteilbar zu machen.</p>
<div class="admonition note">
<p class="admonition-title">Thread.Sleep(500)</p>
<p>Die Rolle der Code-Zeile <code>Thread.Sleep(500);</code>, die auf die Code-Zeile folgt, die die Leere-Prüfung in unserem Beispielcode überwacht, besteht nur darin, die Wahrscheinlichkeit zu erhöhen, dass das obige unglückliche Szenario eintritt, und somit das Beispiel anschaulicher zu machen (da es fast sicher ist, dass der Thread neu geplant wird). Wir werden dies in Zukunft herausnehmen, aber vorläufig lassen wir es drin.</p>
</div>
<h3 id="problem-2">Problem 2<a class="headerlink" href="#problem-2" title="Permanent link">&para;</a></h3>
<p>Die Klasse <code>DataFifo</code> kann von mehreren Threads gleichzeitig auf die Mitgliedsvariable <code>_innerList</code> <code>List&lt;double[]&gt;</code> zugreifen. Wenn Sie sich jedoch die Dokumentation zu <code>List&lt;T&gt;</code> ansehen, werden Sie feststellen, dass die Klasse nicht thread-sicher ist. Aber in diesem Fall können wir das nicht tun, wir müssen Sperren verwenden, um sicherzustellen, dass unser Code nur auf eine Methode/Eigenschaft/Mitgliedsvariable zur gleichen Zeit zugreifen kann (genauer gesagt, kann Inkonsistenz nur im Fall von gleichzeitigen Schreib- oder Lesevorgängen auftreten, aber wir unterscheiden in den meisten Fällen nicht zwischen Lesern und Schreibern, und wir tun es hier auch nicht).</p>
<p>Der nächste Schritt besteht darin, unsere Klasse <code>DataFifo</code> thread-sicher zu machen, wodurch die beiden oben genannten Probleme vermieden werden.</p>
<h2 id="6-problem-2-die-datafifo-klasse-sicher-machen">6. problem 2 - Die DataFifo-Klasse sicher machen<a class="headerlink" href="#6-problem-2-die-datafifo-klasse-sicher-machen" title="Permanent link">&para;</a></h2>
<p>Um die Klasse <code>DataFifo</code> thread-sicher zu machen, benötigen wir ein Objekt (dies kann ein beliebiges Objekt vom Referenztyp sein), das als Schlüssel zum Sperren verwendet wird. Mit dem Schlüsselwort <code>lock</code> können wir dann sicherstellen, dass sich jeweils nur ein Thread in den durch diesen Schlüssel geschützten Blöcken aufhält.</p>
<ol>
<li>
<p>Fügen Sie ein Feld vom Typ <code>object</code> mit dem Namen <code>_syncRoot</code> zur Klasse <code>DataFifo</code> hinzu.</p>
<div class="highlight"><pre><span></span><code><span class="k">private</span><span class="w"> </span><span class="kt">object</span><span class="w"> </span><span class="n">_syncRoot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">object</span><span class="p">();</span>
</code></pre></div>
</li>
<li>
<p>Füllen Sie die Funktionen <code>Put</code> und <code>TryGet</code> mit dem Schloss aus.</p>
<div class="highlight"><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Put</span><span class="p">(</span><span class="kt">double</span><span class="p">[]</span><span class="w"> </span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
<span class="hll"><span class="w">    </span><span class="k">lock</span><span class="w"> </span><span class="p">(</span><span class="n">_syncRoot</span><span class="p">)</span>
</span><span class="hll"><span class="w">    </span><span class="p">{</span>
</span><span class="w">        </span><span class="n">_innerList</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">data</span><span class="p">);</span><span class="w"> </span>
<span class="hll"><span class="w">    </span><span class="p">}</span>
</span><span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">TryGet</span><span class="p">(</span><span class="k">out</span><span class="w"> </span><span class="kt">double</span><span class="p">[]</span><span class="w"> </span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
<span class="hll"><span class="w">    </span><span class="k">lock</span><span class="w"> </span><span class="p">(</span><span class="n">_syncRoot</span><span class="p">)</span>
</span><span class="hll"><span class="w">    </span><span class="p">{</span>
</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">_innerList</span><span class="p">.</span><span class="n">Count</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">Thread</span><span class="p">.</span><span class="n">Sleep</span><span class="p">(</span><span class="m">500</span><span class="p">);</span>

<span class="w">            </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_innerList</span><span class="p">[</span><span class="m">0</span><span class="p">];</span>
<span class="w">            </span><span class="n">_innerList</span><span class="p">.</span><span class="n">RemoveAt</span><span class="p">(</span><span class="m">0</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>
<span class="hll"><span class="w">    </span><span class="p">}</span>
</span><span class="p">}</span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Surround with</p>
<p>Verwenden Sie die Funktion <em>"Surround with"</em> von Visual Studio, indem Sie STRG + K, STRG + S auf dem ausgewählten Codeschnipsel drücken, den Sie umschließen möchten.</p>
</div>
</li>
</ol>
<p>Jetzt dürfen wir keine Ausnahme bekommen.</p>
<p>Sie können die künstliche Verzögerung auch aus der Methode <code>TryGet</code> entfernen ( Zeile<code>Thread.Sleep(500);</code> ).</p>
<div class="admonition error">
<p class="admonition-title">Locking on <code>this</code></p>
<p>Es stellt sich die Frage, warum wir eine separate Membervariable <code>_syncRoot</code> eingeführt und diese als Locking-Parameter für <code>lock</code> verwendet haben, wenn wir stattdessen auch <code>this</code>hätten verwenden können ( <code>DataFifo</code> ist der Referenztyp, daher wäre dies kein Problem). Die Verwendung von <code>this</code> <strong>würde</strong> jedoch <strong>gegen das Unit Lock-in unserer Abteilung verstoßen</strong>! Erinnern Sie sich: <code>this</code> ist ein Verweis auf unser Objekt, aber andere Klassen haben Verweise auf dasselbe Objekt (z.B. in unserem Fall <code>MainWindow</code>hat einen Verweis auf <code>DataFifo</code>), und wenn diese externen Klassen eine Sperre auf das Objekt setzen, indem sie <code>lock</code> verwenden, wird dies die Sperre "stören", die wir auf die Klasse darin verwenden (da die Verwendung von <code>this</code> dazu führt, dass die externen und internen <code>lock</code>denselben Parameter haben). Zum Beispiel kann eine externe Sperre verwendet werden, um die Operationen <code>TryGet</code> und <code>Put</code> vollständig "lahmzulegen". Im Gegensatz dazu ist in unserer Lösung der Parameter <code>lock</code>, die Variable <code>_syncRoot</code>, privat und kann nicht von externen Klassen aufgerufen werden, so dass sie die internen Abläufe unserer Klasse nicht beeinträchtigen kann.</p>
</div>
<h2 id="7-aufgabe-1-umsetzung-einer-wirksamen-signalisierung">7. aufgabe 1 - Umsetzung einer wirksamen Signalisierung<a class="headerlink" href="#7-aufgabe-1-umsetzung-einer-wirksamen-signalisierung" title="Permanent link">&para;</a></h2>
<h3 id="manualresetevent-verwenden">ManualResetEvent verwenden<a class="headerlink" href="#manualresetevent-verwenden" title="Permanent link">&para;</a></h3>
<p>Die Schleife <code>while</code>, die in <code>WorkerThread</code>ständig läuft, implementiert ein sogenanntes aktives Warten, das immer vermieden werden sollte. Wäre <code>Thread.Sleep</code>nicht in den Schleifenkern eingebaut worden, wäre der Prozessor überlastet gewesen.  <code>Thread.Sleep</code> löst zwar das Problem der CPU-Belastung, führt aber ein weiteres ein: Wenn sich alle drei Arbeitsstationen im Ruhezustand befinden, wenn neue Daten empfangen werden, warten wir unnötigerweise 500 ms, bevor wir mit der Verarbeitung der Daten beginnen.</p>
<p>Im Folgenden wird die Anwendung so geändert, dass sie in einem blockierten Zustand wartet, bis Daten zum FIFO hinzugefügt werden (aber wenn Daten hinzugefügt werden, beginnt sie sofort mit der Verarbeitung). Um anzuzeigen, ob sich Daten in der Warteschlange befinden, wird <code>ManualResetEvent</code>verwendet.</p>
<ol>
<li>
<p>Fügen Sie eine Instanz von <code>MaunalResetEvent</code> zu Ihrer Klasse <code>DataFifo</code> als <code>_hasData</code> hinzu.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// A false konstruktor paraméter eredményeképpen kezdetben az esemény nem jelzett (kapu csukva)</span>
<span class="k">private</span><span class="w"> </span><span class="n">ManualResetEvent</span><span class="w"> </span><span class="n">_hasData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ManualResetEvent</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>
</code></pre></div>
</li>
<li>
<p>Es fungiert als Gateway in unserer Anwendung <code>_hasData</code>.  Wenn der Liste Daten hinzugefügt werden, wird sie "geöffnet", und wenn die Liste geleert wird, wird sie "geschlossen".</p>
<div class="admonition tip">
<p class="admonition-title">Semantik und Namensgebung der Veranstaltung</p>
<p>Es ist wichtig, die Semantik Ihrer Veranstaltung gut zu wählen und sie im Namen Ihrer Veranstaltung präzise auszudrücken. In unserem Beispiel drückt der Name <code>_hasData</code> aus, dass unser Ereignis genau dann und nur dann signalisiert wird, wenn es Daten zu verarbeiten gibt (Gateway geöffnet). Jetzt müssen wir "nur" noch diese Semantik implementieren: das Ereignis in flagged setzen, wenn Daten in den FIFO eingegeben werden, und in unsigned, wenn der FIFO geleert wird.</p>
</div>
<div class="highlight"><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Put</span><span class="p">(</span><span class="kt">double</span><span class="p">[]</span><span class="w"> </span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">lock</span><span class="w"> </span><span class="p">(</span><span class="n">_syncRoot</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">_innerList</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
<span class="hll"><span class="w">        </span><span class="n">_hasData</span><span class="p">.</span><span class="n">Set</span><span class="p">();</span>
</span><span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">TryGet</span><span class="p">(</span><span class="k">out</span><span class="w"> </span><span class="kt">double</span><span class="p">[]</span><span class="w"> </span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">lock</span><span class="w"> </span><span class="p">(</span><span class="n">_syncRoot</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">_innerList</span><span class="p">.</span><span class="n">Count</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_innerList</span><span class="p">[</span><span class="m">0</span><span class="p">];</span>
<span class="w">            </span><span class="n">_innerList</span><span class="p">.</span><span class="n">RemoveAt</span><span class="p">(</span><span class="m">0</span><span class="p">);</span>
<span class="hll"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">_innerList</span><span class="p">.</span><span class="n">Count</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">)</span>
</span><span class="hll"><span class="w">            </span><span class="p">{</span>
</span><span class="hll"><span class="w">                </span><span class="n">_hasData</span><span class="p">.</span><span class="n">Reset</span><span class="p">();</span>
</span><span class="hll"><span class="w">            </span><span class="p">}</span>
</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</li>
</ol>
<h3 id="warten-auf-signal-blockieren-des-get">Warten auf Signal (Blockieren des Get)<a class="headerlink" href="#warten-auf-signal-blockieren-des-get" title="Permanent link">&para;</a></h3>
<p>Der vorherige Punkt wurde gelöst, aber das ist an sich nicht viel wert, da es nicht erwartet wird. Diese Erkenntnis kommt jetzt.</p>
<ol>
<li>
<p>Ändern Sie die Methode wie folgt: Streichen Sie den Leere-Test und ersetzen Sie ihn durch Warten auf das Ereignis.</p>
<div class="highlight"><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">TryGet</span><span class="p">(</span><span class="k">out</span><span class="w"> </span><span class="kt">double</span><span class="p">[]</span><span class="w"> </span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">lock</span><span class="w"> </span><span class="p">(</span><span class="n">_syncRoot</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="hll"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">_hasData</span><span class="p">.</span><span class="n">WaitOne</span><span class="p">())</span>
</span><span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// ...</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Überprüfung des Rückgabewerts der Operation WaitOne</p>
<p>Die Operation <code>WaitOne</code> gibt den Wert <code>bool</code> zurück, der wahr ist, wenn sich das Ereignis vor der im Parameter <code>WaitOne</code> angegebenen Zeitspanne in dem angegebenen Zustand befindet (und entsprechend falsch, wenn die Zeitspanne abgelaufen ist). In unserem Beispiel haben wir im Parameter kein Zeitlimit angegeben, was eine unendliche Zeitspanne bedeutet. Dementsprechend ist die Prüfung der Bedingung <code>if</code> überflüssig, da in unserem Fall <code>WaitOne()</code> immer einen wahren Wert liefert. Dies ist der einzige Grund, warum wir dennoch die Konditionstests verwendet haben: Sie erfordern weniger Änderungen für die nächste und eine zukünftige Übung.</p>
</div>
</li>
<li>
<p>Dies macht <code>Thread.Sleep</code> in <code>WorkerThread</code>überflüssig, kommentieren Sie es aus!</p>
<p>Wenn Sie die obige Lösung ausführen, werden Sie feststellen, dass die Oberfläche Ihrer Anwendung nach dem ersten Tastendruck einfriert. Bei unserer vorherigen Lösung haben wir einen Anfängerfehler gemacht. In dem gesperrten Codeschnipsel warten wir darauf, dass <code>_hasData</code> gesendet wird, so dass der Hauptthread keine Gelegenheit hat, <code>_hasData</code>in der Operation <code>Put</code> zu senden (ebenfalls geschützt durch <code>lock</code>). <strong>In der Praxis hat sich eine festgefahrene Situation ergeben.</strong></p>
<p>Wir könnten versuchen, ein Zeitlimit (ms) für die Wartezeit festzulegen:</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">_hasData</span><span class="p">.</span><span class="n">WaitOne</span><span class="p">(</span><span class="m">100</span><span class="p">))</span>
</code></pre></div>
<p>Dies wäre an sich keine elegante Lösung, außerdem würden die ständig verschmutzenden Arbeits-Threads den Thread, der Put aufruft, erheblich aushungern! Stattdessen ist das elegante Muster zu folgen, um zu vermeiden, dass man innerhalb einer Sperre blockiert wartet.</p>
<p>Ersetzen Sie <code>lock</code>und <code>WaitOne</code>und entfernen Sie die Wartezeitbegrenzung, indem Sie den Parameter <code>WaitOne</code> entfernen:</p>
<div class="highlight"><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">TryGet</span><span class="p">(</span><span class="k">out</span><span class="w"> </span><span class="kt">double</span><span class="p">[]</span><span class="w"> </span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
<span class="hll"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">_hasData</span><span class="p">.</span><span class="n">WaitOne</span><span class="p">())</span>
</span><span class="hll"><span class="w">    </span><span class="p">{</span>
</span><span class="hll"><span class="w">        </span><span class="k">lock</span><span class="w"> </span><span class="p">(</span><span class="n">_syncRoot</span><span class="p">)</span>
</span><span class="hll"><span class="w">        </span><span class="p">{</span>
</span><span class="w">            </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_innerList</span><span class="p">[</span><span class="m">0</span><span class="p">];</span>
<span class="w">            </span><span class="n">_innerList</span><span class="p">.</span><span class="n">RemoveAt</span><span class="p">(</span><span class="m">0</span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">_innerList</span><span class="p">.</span><span class="n">Count</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">_hasData</span><span class="p">.</span><span class="n">Reset</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">true</span><span class="p">;</span><span class="w"> </span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>Probieren wir die App aus. Wenn Sie die Taste zum ersten Mal drücken, erhalten Sie eine Ausnahme. Dadurch wird zwar ein Deadlock vermieden, <strong>aber die Threadsicherheit ist beeinträchtigt</strong>, da zu dem Zeitpunkt, zu dem Sie in <code>lock</code>gelangen, möglicherweise keine Elemente mehr in der Liste vorhanden sind. Es kann mehrere Threads geben, die darauf warten, dass ein Element zum Vorgang <code>_hasData.WaitOne()</code> hinzugefügt wird. Wenn dies geschieht, wird unser <code>ManualResetEvent</code> Objekt alle durchlassen (es sei denn, ein Thread schließt es schnell, aber das ist nicht garantiert).</p>
<div class="admonition note">
<p class="admonition-title">The difficulties of programming in a concurrent, multi-threaded environment</p>
<p>Diese Übung veranschaulicht, wie sorgfältig man bei der Programmierung in einer gleichzeitigen Multi-Thread-Umgebung vorgehen muss. Bei den vorherigen hatten wir sogar noch Glück, denn der Fehler war reproduzierbar. In der Praxis ist dies jedoch selten der Fall. Leider ist es viel häufiger der Fall, dass wettbewerbsbedingte Ausfälle gelegentliche, nicht reproduzierbare Probleme verursachen. Die Lösung einer solchen Aufgabe muss immer sehr sorgfältig durchdacht sein und kann nicht nach dem Motto "Probieren geht über Studieren" programmiert werden.</p>
</div>
</li>
<li>
<p>Als Abhilfe sollten wir die Ungültigkeitsprüfung in <code>lock</code>wieder einführen.</p>
<div class="highlight"><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">TryGet</span><span class="p">(</span><span class="k">out</span><span class="w"> </span><span class="kt">double</span><span class="p">[]</span><span class="w"> </span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">_hasData</span><span class="p">.</span><span class="n">WaitOne</span><span class="p">())</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">lock</span><span class="w"> </span><span class="p">(</span><span class="n">_syncRoot</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="hll"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">_innerList</span><span class="p">.</span><span class="n">Count</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0</span><span class="p">)</span>
</span><span class="hll"><span class="w">            </span><span class="p">{</span>
</span><span class="w">                </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_innerList</span><span class="p">[</span><span class="m">0</span><span class="p">];</span>
<span class="w">                </span><span class="n">_innerList</span><span class="p">.</span><span class="n">RemoveAt</span><span class="p">(</span><span class="m">0</span><span class="p">);</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">_innerList</span><span class="p">.</span><span class="n">Count</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">)</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="n">_hasData</span><span class="p">.</span><span class="n">Reset</span><span class="p">();</span>
<span class="w">                </span><span class="p">}</span>

<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="k">true</span><span class="p">;</span><span class="w">  </span>
<span class="hll"><span class="w">            </span><span class="p">}</span>
</span><span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>Dies funktioniert bereits gut. Es ist möglich, dass wir unnötigerweise auf die Liste eingehen, aber wir belassen es vorerst dabei.</p>
<p>Testen wir die App!</p>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">System.Collections.Concurrent</p>
<p>Im .NET-Framework gibt es mehrere eingebaute thread-sichere Klassen im Namensraum <code>System.Collections.Concurrent</code>.  In dem obigen Beispiel hätte die Klasse <code>DataFifo</code> durch <code>System.Collections.Concurrent.ConcurrentQueue</code> ersetzt werden können.</p>
</div>
<h2 id="8-aufgabe-1-kultivierter-stillstand">8. aufgabe 1 - Kultivierter Stillstand<a class="headerlink" href="#8-aufgabe-1-kultivierter-stillstand" title="Permanent link">&para;</a></h2>
<p>Bisher haben wir das Problem, dass unser Prozess beim Schließen des Fensters "stecken bleibt", beiseite gelassen, weil die Verarbeitungsthreads Vorverarbeitungsthreads sind und wir das Problem des Beendens dieser Threads nicht gelöst haben. Unser Ziel ist es, den unendlichen <code>while</code> -Zyklus auszulösen, so dass unsere Arbeits-Threads auf zivilisierte Weise beendet werden, wenn die Anwendung geschlossen wird.</p>
<ol>
<li>
<p>Ein <code>ManualResetEvent</code> wird verwendet, um einen Stopp im FIFO anzuzeigen, während in <code>TryGet</code>gewartet wird. Fügen Sie im FIFO ein neues <code>ManualResetEvent</code>hinzu und führen Sie eine <code>Release</code> -Operation ein, um unsere Wartezeiten zu verkürzen (unser neues Ereignis kann auf einen markierten Zustand gesetzt werden).</p>
<div class="highlight"><pre><span></span><code><span class="k">private</span><span class="w"> </span><span class="n">ManualResetEvent</span><span class="w"> </span><span class="n">_releaseTryGet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ManualResetEvent</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>

<span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Release</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">_releaseTryGet</span><span class="p">.</span><span class="n">Set</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>Bleiben Sie auf <code>TryGet</code>für diese Veranstaltung. Die Methode <code>WaitAny</code> darf die Ausführung fortsetzen, wenn sich eines der als Parameter angegebenen Objekte vom Typ <code>WaitHandle</code> in dem angegebenen Zustand befindet, und gibt dessen Massenindex zurück. Und wir wollen die tatsächliche Verarbeitung nur, wenn <code>_hasData</code> markiert ist (wenn <code>WaitAny</code> 0 zurückgibt).</p>
<div class="highlight"><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">TryGet</span><span class="p">(</span><span class="k">out</span><span class="w"> </span><span class="kt">double</span><span class="p">[]</span><span class="w"> </span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
<span class="hll"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">WaitHandle</span><span class="p">.</span><span class="n">WaitAny</span><span class="p">(</span><span class="k">new</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">_hasData</span><span class="p">,</span><span class="w"> </span><span class="n">_releaseTryGet</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">)</span>
</span><span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">lock</span><span class="w"> </span><span class="p">(</span><span class="n">_syncRoot</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
</code></pre></div>
</li>
<li>
<p><code>MainWindow.xaml.cs</code>-eine Flaggenvariable hinzufügen, um den Abschluss anzuzeigen:</p>
<div class="highlight"><pre><span></span><code><span class="k">private</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">_isClosed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>
</code></pre></div>
</li>
<li>
<p>Wenn das Hauptfenster geschlossen wird, setzen Sie das neue Ereignis auf "flagged" und setzen Sie auch das Flag: abonnieren Sie das Ereignis <code>Closed</code> der Klasse <code>MainWindow</code> im Konstruktor und schreiben Sie die entsprechende Ereignisbehandlungsfunktion:</p>
<div class="highlight"><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="nf">MainWindow</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="p">...</span>

<span class="w">    </span><span class="n">Closed</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">MainWindow_Closed</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">MainWindow_Closed</span><span class="p">(</span><span class="kt">object</span><span class="w"> </span><span class="n">sender</span><span class="p">,</span><span class="w"> </span><span class="n">WindowEventArgs</span><span class="w"> </span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">_isClosed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
<span class="w">    </span><span class="n">_fifo</span><span class="p">.</span><span class="n">Release</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>Schreiben wir die while-Schleife so um, dass sie auf das im vorigen Abschnitt aufgegriffene Flag wartet.</p>
<div class="highlight"><pre><span></span><code><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">WorkerThread</span><span class="p">()</span>
<span class="p">{</span>
<span class="hll"><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">_isClosed</span><span class="p">)</span>
</span><span class="w">    </span><span class="p">{</span>
</code></pre></div>
</li>
<li>
<p>Stellen Sie sicher, dass Sie nicht versuchen, Nachrichten für ein Fenster zu drucken, das bereits geschlossen ist</p>
<div class="highlight"><pre><span></span><code><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ShowResult</span><span class="p">(</span><span class="kt">double</span><span class="p">[]</span><span class="w"> </span><span class="n">parameters</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">result</span><span class="p">)</span>
<span class="p">{</span>
<span class="hll"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">_isClosed</span><span class="p">)</span>
</span><span class="hll"><span class="w">        </span><span class="k">return</span><span class="p">;</span>
</span></code></pre></div>
</li>
<li>
<p>Führen Sie die Anwendung aus und überprüfen Sie, ob unser Prozess tatsächlich beendet wird, wenn Sie ihn beenden.</p>
</li>
</ol>
<h2 id="ausblick-task-async-await">Ausblick: Task, async, await<a class="headerlink" href="#ausblick-task-async-await" title="Permanent link">&para;</a></h2>
<p>Ziel der Übung war es, die Techniken für das Management von Fasern auf unterer Ebene kennen zu lernen. Wir hätten unsere Lösung jedoch (zumindest teilweise) auf den übergeordneten Werkzeugen und Mechanismen aufbauen können, die die asynchrone Programmierung in .NET unterstützen, z. B. die Klassen <code>Task</code>/<code>Task&lt;T&gt;</code> und die Schlüsselwörter <code>async</code>/<code>await</code>. </p>
<hr>
<div class="md-source-file">
  <span class="md-source-file__fact"> <span class="md-icon" title="Utolsó frissítés"> <svg
        xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <path
          d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z">
        </path>
      </svg>
    </span>
    <span title="2024. március 9. 10:46:58">
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class="timeago" datetime="2024-03-09T10:46:58+01:00" locale="hu"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2024-03-09</span>
    </span>
  </span>

  

  <span class="md-source-file__fact">
    <span class="md-icon" title="Szerzők">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <path
          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z">
        </path>
      </svg>
    </span>
    <span>Szerzők</span>
    <nav><a href="https://github.com/bzolka" target="_blank" rel="noopener noreferrer" class="md-author" title="@Zoltán Benedek">
        <img src="https://avatars.githubusercontent.com/u/22932444?u=a3e164177137cbef68f0e72985785b0795ac7565&v=4?size=72" alt="@Zoltán Benedek">
      </a></nav>      
  </span>
</div>




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Vissza a tetejére
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; BME VIK AUT
    </div>
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.instant", "navigation.top", "search.suggest", "content.action.edit", "toc.follow"], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "V\u00e1g\u00f3lapra m\u00e1solva", "clipboard.copy": "M\u00e1sol\u00e1s v\u00e1g\u00f3lapra", "search.result.more.one": "1 tov\u00e1bbi tal\u00e1lat az oldalon", "search.result.more.other": "# tov\u00e1bbi tal\u00e1lat az oldalon", "search.result.none": "Nincs tal\u00e1lat", "search.result.one": "1 egyez\u0151 dokumentum", "search.result.other": "# egyez\u0151 dokumentum", "search.result.placeholder": "Keres\u00e9shez \u00edrj ide valamit", "search.result.term.missing": "\u00dcres", "select.version": "Verzi\u00f3v\u00e1lt\u00e1s"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.8fd75fb4.min.js"></script>
      
        <script src="../../../js/timeago.min.js"></script>
      
        <script src="../../../js/timeago_mkdocs_material.js"></script>
      
    
  <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>